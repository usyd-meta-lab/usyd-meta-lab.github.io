<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
   <title>USYD Meta Lab â€¢ Meetings</title>
  	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f9fafb;
      --text: #0f172a;
      --muted: #475569;
      --card: #ffffff;
      --border: #e5e7eb;
      --accent: #1e40af;
      --accent-light: #3b82f6;
      --danger: #dc2626;
      --success: #16a34a;
      --radius: 14px;
      --shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -2px rgba(0,0,0,.1);
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font: 16px/1.6 -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display",
            "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    .logo {
      height: 70px;
      margin-bottom: 16px;
    }
    .header h1 {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 8px;
      letter-spacing: -0.02em;
    }
    .header p {
      color: var(--muted);
      margin: 0;
      font-size: 15px;
    }
    .back-link {
      margin-bottom: 24px;
      font-size: 14px;
    }

    .info-card {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
    }
    .info-card h2 {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 16px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }
    .info-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .info-icon {
      width: 40px;
      height: 40px;
      background: var(--bg);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .info-icon svg {
      width: 20px;
      height: 20px;
      color: var(--muted);
    }
    .info-label {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 2px;
    }
    .info-value {
      font-weight: 500;
      font-size: 15px;
    }

    .schedule-card {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
    }
    .schedule-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    .schedule-card h2 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }
    .schedule-card > p {
      color: var(--muted);
      font-size: 14px;
      margin: 0 0 20px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: 500;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .btn-primary {
      background: var(--accent);
      color: white;
    }
    .btn-primary:hover {
      background: var(--accent-light);
    }
    .btn-secondary {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      background: var(--border);
    }
    .btn-danger {
      background: var(--danger);
      color: white;
    }
    .btn-danger:hover {
      opacity: 0.9;
    }
    .btn-success {
      background: var(--success);
      color: white;
    }
    .btn-success:hover {
      opacity: 0.9;
    }
    .btn-sm {
      padding: 4px 10px;
      font-size: 13px;
    }
    .btn-icon {
      padding: 6px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--muted);
      border-radius: 6px;
    }
    .btn-icon:hover {
      background: var(--bg);
      color: var(--text);
    }
    .btn-icon svg {
      width: 18px;
      height: 18px;
    }

    .schedule-table {
      width: 100%;
      border-collapse: collapse;
    }
    .schedule-table th,
    .schedule-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    .schedule-table th {
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      background: var(--bg);
    }
    .schedule-table tbody tr:hover {
      background: var(--bg);
    }
    .schedule-table tbody tr:last-child td {
      border-bottom: none;
    }
    .presenter {
      font-weight: 500;
    }
    .topic {
      color: var(--muted);
      font-size: 14px;
    }
    .date {
      white-space: nowrap;
    }
    .actions {
      display: flex;
      gap: 4px;
      justify-content: flex-end;
    }

    /* Clickable cells for inline editing */
    .editable {
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.15s ease;
    }
    .editable:hover {
      background: var(--bg);
    }

    /* Row selection and delete button visibility */
    .schedule-table tbody tr .btn-delete {
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    .schedule-table tbody tr.selected {
      background: var(--bg);
    }
    .schedule-table tbody tr.selected .btn-delete {
      opacity: 1;
    }

    /* Inline editing styles */
    .editable-cell {
      position: relative;
    }
    .editable-input {
      width: 100%;
      padding: 6px 10px;
      font-size: 14px;
      font-family: inherit;
      border: 2px solid var(--accent);
      border-radius: 6px;
      background: white;
      outline: none;
      margin: -8px 0;
    }
    .editable-input:focus {
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }

    /* Add meeting form */
    .add-meeting-row td {
      padding: 8px 16px;
      background: var(--bg);
    }
    .add-meeting-row input {
      width: 100%;
      padding: 8px 12px;
      font-size: 14px;
      font-family: inherit;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: white;
    }
    .add-meeting-row input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }

    /* Status message */
    .status-message {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: var(--shadow);
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }
    .status-message.success {
      background: var(--success);
      color: white;
    }
    .status-message.error {
      background: var(--danger);
      color: white;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @media (max-width: 600px) {
      .info-grid {
        grid-template-columns: 1fr;
      }
      .schedule-table th,
      .schedule-table td {
        padding: 10px 12px;
        font-size: 14px;
      }
      .schedule-header {
        flex-direction: column;
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <header class="header">
     <img src="https://usyd-meta-lab.github.io/images/logo.PNG" alt="USYD Meta Lab" class="logo" />
      <h1>Lab Meeting Schedule</h1>
      <p>USYD Meta Lab and CogFlex research meetings</p>
    </header>

    <div class="info-card">
      <h2>Meeting Details</h2>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
            </svg>
          </div>
          <div>
            <div class="info-label">Location</div>
            <div class="info-value">Griffith Taylor Building, Room 462</div>
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <div>
            <div class="info-label">Time</div>
            <div class="info-value">10:00 AM</div>
          </div>
        </div>
        <div class="info-item">
          <div class="info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
            </svg>
          </div>
          <div>
            <div class="info-label">Frequency</div>
            <div class="info-value">Fortnightly Fridays (during semester)</div>
          </div>
        </div>
      </div>
    </div>

    <div class="schedule-card">
      <div class="schedule-header">
        <div>
          <h2>Upcoming Meetings</h2>
        </div>
        <button class="btn btn-primary" onclick="showAddForm()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Add Meeting
        </button>
      </div>
      <p>Schedule for the current semester</p>
      <table class="schedule-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Presenter</th>
            <th>Topic</th>
            <th style="width: 40px;"></th>
          </tr>
        </thead>
        <tbody id="schedule-body">
          <tr>
            <td colspan="4" style="text-align: center; color: var(--muted);">
              Loading schedule...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // ============================================================
    // FIREBASE CONFIGURATION
    // ============================================================
    // TODO: Replace with your Firebase project configuration
    // Get this from: Firebase Console > Project Settings > Your apps > Web app
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

const firebaseConfig = {
  apiKey: "AIzaSyBaz1nWglmiKv9W_MrbulS__h8aieCPPE8",
  authDomain: "meetings-b9e5e.firebaseapp.com",
  projectId: "meetings-b9e5e",
  storageBucket: "meetings-b9e5e.firebasestorage.app",
  messagingSenderId: "368747163289",
  appId: "1:368747163289:web:29719439e3b61126331208"
};

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const meetingsCollection = collection(db, 'meetings');

    // Make functions available globally
    window.db = db;
    window.meetingsCollection = meetingsCollection;

    // ============================================================
    // UTILITY FUNCTIONS
    // ============================================================
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function parseDate(dateStr) {
      if (!dateStr) return null;
      // Handle YYYY-MM-DD format (HTML date input)
      if (dateStr.includes('-')) {
        return new Date(dateStr + 'T00:00:00');
      }
      // Handle DD/MM/YYYY format (Australian)
      const parts = dateStr.split('/');
      if (parts.length === 3) {
        const [day, month, year] = parts;
        return new Date(year, month - 1, day);
      }
      return new Date(dateStr);
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = parseDate(dateStr);
      if (!date || isNaN(date.getTime())) return escapeHtml(String(dateStr));
      return date.toLocaleDateString('en-AU', {
        day: 'numeric',
        month: 'short'
      });
    }

    function formatDateForInput(dateStr) {
      if (!dateStr) return '';
      const date = parseDate(dateStr);
      if (!date || isNaN(date.getTime())) return '';
      return date.toISOString().split('T')[0];
    }

    function showStatus(message, type = 'success') {
      const existing = document.querySelector('.status-message');
      if (existing) existing.remove();

      const div = document.createElement('div');
      div.className = `status-message ${type}`;
      div.textContent = message;
      document.body.appendChild(div);

      setTimeout(() => div.remove(), 3000);
    }

    // ============================================================
    // CRUD OPERATIONS
    // ============================================================
    async function loadMeetings() {
      const tbody = document.getElementById('schedule-body');

      try {
        const q = query(meetingsCollection, orderBy('date', 'asc'));
        const snapshot = await getDocs(q);
        const meetings = [];

        snapshot.forEach(doc => {
          meetings.push({ id: doc.id, ...doc.data() });
        });

        // Filter to show only future meetings
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const futureMeetings = meetings.filter(m => {
          const meetingDate = parseDate(m.date);
          return meetingDate && meetingDate >= today;
        });

        const meetingsToShow = futureMeetings.length > 0 ? futureMeetings : meetings;
        renderMeetings(meetingsToShow);
      } catch (error) {
        console.error('Failed to load meetings:', error);
        tbody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align: center; color: var(--muted);">
              Failed to load schedule. Check Firebase configuration.
            </td>
          </tr>
        `;
      }
    }

    function renderMeetings(meetings) {
      const tbody = document.getElementById('schedule-body');

      if (!meetings || meetings.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="4" style="text-align: center; color: var(--muted);">
              No meetings scheduled. Click "Add Meeting" to create one.
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = meetings.map(meeting => `
        <tr data-id="${meeting.id}" data-date="${meeting.date}" data-presenter="${escapeHtml(meeting.presenter || '')}" data-topic="${escapeHtml(meeting.topic || '')}">
          <td class="date editable" onclick="editCell('${meeting.id}', 'date', this)">${formatDate(meeting.date)}</td>
          <td class="presenter editable" onclick="editCell('${meeting.id}', 'presenter', this)">${escapeHtml(meeting.presenter)}</td>
          <td class="topic editable" onclick="editCell('${meeting.id}', 'topic', this)">${escapeHtml(meeting.topic)}</td>
          <td class="actions">
            <button class="btn-icon btn-delete" onclick="event.stopPropagation(); deleteMeeting('${meeting.id}')" title="Delete" style="color: var(--danger);">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
              </svg>
            </button>
          </td>
        </tr>
      `).join('');

      // Add row click handlers for selection
      tbody.querySelectorAll('tr[data-id]').forEach(row => {
        row.addEventListener('click', () => selectRow(row));
      });
    }

    let selectedRowId = null;

    function selectRow(row) {
      // Deselect previous row
      const prevSelected = document.querySelector('.schedule-table tbody tr.selected');
      if (prevSelected && prevSelected !== row) {
        prevSelected.classList.remove('selected');
      }
      // Select this row
      row.classList.add('selected');
      selectedRowId = row.dataset.id;
    }

    // Click outside to deselect
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.schedule-table tbody tr[data-id]') && !e.target.closest('.editable-input')) {
        const selected = document.querySelector('.schedule-table tbody tr.selected');
        if (selected) selected.classList.remove('selected');
        selectedRowId = null;
      }
    });

    window.editCell = async function(id, field, cell) {
      // Prevent if already editing
      if (cell.querySelector('input')) return;

      const row = cell.closest('tr');
      selectRow(row);

      const currentValue = row.dataset[field] || '';
      const isDate = field === 'date';

      // Create input
      const input = document.createElement('input');
      input.type = isDate ? 'date' : 'text';
      input.className = 'editable-input';
      input.value = isDate ? formatDateForInput(currentValue) : currentValue;

      // Replace cell content with input
      cell.innerHTML = '';
      cell.appendChild(input);
      input.focus();
      if (!isDate) input.select();

      // Save on blur or Enter
      const saveChanges = async () => {
        const newValue = input.value.trim();

        // Validate date
        if (isDate && !newValue) {
          showStatus('Date is required', 'error');
          loadMeetings();
          return;
        }

        // Check if value changed
        const oldValue = isDate ? formatDateForInput(currentValue) : currentValue;
        if (newValue === oldValue) {
          loadMeetings();
          return;
        }

        try {
          const docRef = doc(db, 'meetings', id);
          await updateDoc(docRef, { [field]: isDate ? newValue : newValue });
          showStatus('Updated');
          loadMeetings();
        } catch (error) {
          console.error('Failed to update:', error);
          showStatus('Failed to update', 'error');
          loadMeetings();
        }
      };

      input.addEventListener('blur', saveChanges);
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          input.blur();
        }
        if (e.key === 'Escape') {
          loadMeetings();
        }
      });
    };

    window.showAddForm = function() {
      const tbody = document.getElementById('schedule-body');
      const existingForm = document.getElementById('add-meeting-row');
      if (existingForm) {
        existingForm.remove();
        return;
      }

      const row = document.createElement('tr');
      row.id = 'add-meeting-row';
      row.className = 'add-meeting-row';
      row.innerHTML = `
        <td><input type="date" id="new-date" required></td>
        <td><input type="text" id="new-presenter" placeholder="Presenter name"></td>
        <td><input type="text" id="new-topic" placeholder="Topic"></td>
        <td class="actions">
          <button class="btn btn-success btn-sm" onclick="saveMeeting()">Save</button>
          <button class="btn btn-secondary btn-sm" onclick="cancelAdd()">Cancel</button>
        </td>
      `;
      tbody.insertBefore(row, tbody.firstChild);
      document.getElementById('new-date').focus();
    };

    window.cancelAdd = function() {
      const row = document.getElementById('add-meeting-row');
      if (row) row.remove();
    };

    window.saveMeeting = async function() {
      const date = document.getElementById('new-date').value;
      const presenter = document.getElementById('new-presenter').value.trim();
      const topic = document.getElementById('new-topic').value.trim();

      if (!date) {
        showStatus('Date is required', 'error');
        return;
      }

      try {
        await addDoc(meetingsCollection, { date, presenter, topic });
        showStatus('Meeting added successfully');
        loadMeetings();
      } catch (error) {
        console.error('Failed to add meeting:', error);
        showStatus('Failed to add meeting', 'error');
      }
    };

    window.deleteMeeting = async function(id) {
      if (!confirm('Are you sure you want to delete this meeting?')) return;

      try {
        const docRef = doc(db, 'meetings', id);
        await deleteDoc(docRef);
        showStatus('Meeting deleted');
        loadMeetings();
      } catch (error) {
        console.error('Failed to delete meeting:', error);
        showStatus('Failed to delete meeting', 'error');
      }
    };

    // Load meetings when page is ready
    document.addEventListener('DOMContentLoaded', loadMeetings);
  </script>
</body>
</html>
